(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{999:function(n,e,s){"use strict";s.r(e);var t={data:()=>({link:"",str:'\n        <template>\n          <uni-popup ref="popupDown" type="center" :maskClick="!downLoadIng">\n            <view class="confirmbox">\n              <view class="title">版本更新</view>\n              <view class="center" v-if="!downLoadIng">确定更新应用么</view>\n              <view class="btns" v-if="!downLoadIng">\n                <view class="btn" @tap="closePropDown">取消</view>\n                <view class="btn" @tap="confirmBtnDown">确认</view>\n              </view>\n              <load-line class="title" v-if="downLoadIng" loadType="line" :loadText="loadText" :lineInfo="lineInfo" :loadPercent="loadPercent"></load-line>\n            </view>\n          </uni-popup>\n        </template>\n\n        <script>\n          import uniPopup from \'@/components/uni-popup/uni-popup.vue\';\n          \n          export default {\n            components: {\n              uniPopup\n            },\n            data() {\n              return {\n                downLoadIng: false,\n                lineInfo: {\n                  colorChange: false,\n                  loadColor: \'#6ee2e1,#2ba98c,#a07e1e\'\n                },\n                loadText: \'正在下载更新，请耐心等待:\',\n                loadPercent: 0,\n                appversion: \'\',\n                serverversion: \'\'\n              }\n            },\n            methods: {\n              // 获取当前版本和最新版本信息\n              getNewVersion(){\n                let this_ = this;\n                plus.runtime.getProperty(plus.runtime.appid, async function(wgtinfo) {\n                  this_.appversion = wgtinfo.version;\n                  // 请求最新版本信息\n                  this_.$http.request({\n                    method: \'get\',\n                    url: qrSoftVersion,\n                    params: {\n                      versionType: \'APP版本\',\n                      pageIndex: 1,\n                      pageSize: 1\n                    }\n                  }).then(res => {\n                    if (res.resultCode == 1) {\n                      if (res.data.lsList.length > 0) {\n                        this_.serverversion = res.data.lsList[0]\n                      } else {\n                        let serverversionObj = {\n                          versionName: this_.appversion\n                        }\n                        this_.serverversion = serverversionObj;\n                      }\n                      if (this_.serverversion.versionName > this_.appversion) {\n                        this_.appversion = 0\n                      }\n                    }\n                  }).catch(err => {\n                \n                  })\n                });\n              },\n              /**\n               * 显示版本更新弹窗\n               * */\n              showDown() {\n                if (this.serverversion && this.appversion >= this.serverversion.versionName) {\n                  plus.nativeUI.toast(\'已是最新版本\')\n                } else {\n                  this.$refs.popupDown.open();\n                }\n              },\n              closePropDown() {\n                this.$refs.popupDown.close();\n              },\n              confirmBtnDown() {\n                this.downLoad(this.serverversion);\n              },\n              //下载新版本\n              downLoad(ver) {\n                let this_ = this;\n                let fileName = \'\'\n                if (ver.versionPath && ver.versionPath.indexOf(\'apk\') > 0) {\n                  if (plus.os.name == \'Android\') {\n                    fileName = ver.versionPath;\n                  } else if (plus.os.name == \'iOS\') {\n                    // ios应用平台链接\n                    plus.runtime.openURL("https://itunes.apple.com/cn/app/%E6%98%93%E4%BB%A5%E5%85%BB%E8%BD%A6/id1434960351?mt=8");\n                    return;\n                  }\n                } else {\n                  fileName = ver.versionPath;\n                }\n                this_.downLoadIng = true;\n                const downloadTask = uni.downloadFile({\n                  url: apiBaseUrl + fileName,\n                  success: (res) => {\n                    this_.downLoadIng = false;\n                    this_.closePropDown();\n                    if (res.statusCode === 200) {\n                      console.log(\'下载成功\');\n                      this_.installWgt(res.tempFilePath);\n                    } else {\n                      this_.toast("下载更新资源失败！");\n                    }\n                  }\n                });\n\n                downloadTask.onProgressUpdate((res) => {\n                  this_.loadPercent = res.progress;\n                });\n\n              },\n              installWgt(path) {\n                plus.nativeUI.showWaiting("安装更新资源...", {\n                  back: "none"\n                });\n                plus.runtime.install(path, {}, function() {\n                  plus.nativeUI.showWaiting("应用资源更新完成！");\n                  setTimeout(function() {\n                    if (path.indexOf(\'wgt\') > 0) {\n                      plus.nativeUI.closeWaiting();\n                      plus.runtime.restart();\n                    } else {\n                      plus.runtime.quit();\n                    }\n                  }, 1000)\n\n                }, function(e) {\n                  plus.nativeUI.closeWaiting();\n                  uni.showModal({\n                    title: \'提示\',\n                    content: "安装文件失败[" + e.code + "]：" + e.message,\n                    success() {\n\n                    }\n                  })\n              })\n            }\n          }\n        <\/script>\n      '}),methods:{back(n){this.link=n}}},i=s(23),o=Object(i.a)(t,(function(){var n=this.$createElement,e=this._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":this.$parent.slotKey}},[e("h1",{attrs:{id:"uni-app-版本更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uni-app-版本更新"}},[this._v("#")]),this._v(" uni-APP 版本更新")]),this._v(" "),[e("demo",{attrs:{codeStr:this.str}},[this._v("\n    带有进度条样式的APP 版本更新\n  ")])]],2)}),[],!1,null,null,null);e.default=o.exports}}]);